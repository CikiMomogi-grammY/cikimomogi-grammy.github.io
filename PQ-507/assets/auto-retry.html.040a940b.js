import{_ as p,r as a,o as d,c as m,b as n,a as e,w as s,d as t,e as o}from"./app.9a621f1c.js";const h={},b=e("h1",{id:"retry-api-requests-auto-retry",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#retry-api-requests-auto-retry","aria-hidden":"true"},"#"),t(" Retry API Requests ("),e("code",null,[t("auto"),e("wbr"),t("-retry")]),t(")")],-1),g=t("Consider using the "),_=t("throttler plugin"),k=t(" instead."),y=t("This plugin is an "),f=t("API transformer function"),w=t(", which means that it let\u2019s you intercept and modify outgoing HTTP requests on the fly. More specifically, this plugin will automatically detect if an API requests fails with a "),v=e("code",null,[t("retry"),e("wbr"),t("_after")],-1),x=t(" value, i.e. because of rate limiting. It will then catch the error, wait the specified period of time, and then retry the request."),j=o('<div class="custom-container warning"><p class="custom-container-title">Be Gentle With the Bot API Server</p><p>Telegram is generously providing information about how long your bot must wait before the next request. Using the <code>auto<wbr>-retry</code> plugin will allow your bot to perform better during load spikes, as the requests will not simply fail because of the flood limit. However, <strong>auto-retry should not be used</strong> if you want to avoid hitting rate limits on a regular basis. If you regularly cross the threshold of how many requests you may perform, Telegram may take measures such as restricting or banning your bot.</p></div><p>You can install this plugin on the <code>bot<wbr>.api</code> object:</p>',2),q=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"import"),t(),e("span",{class:"token punctuation"},"{"),t(" autoRetry "),e("span",{class:"token punctuation"},"}"),t(),e("span",{class:"token keyword"},"from"),t(),e("span",{class:"token string"},'"@grammyjs/auto-retry"'),e("span",{class:"token punctuation"},";"),t(`

`),e("span",{class:"token comment"},"// Use the plugin."),t(`
bot`),e("span",{class:"token punctuation"},"."),t("api"),e("span",{class:"token punctuation"},"."),t("config"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"use"),e("span",{class:"token punctuation"},"("),e("span",{class:"token function"},"autoRetry"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),t(`
`)])]),e("div",{class:"line-numbers","aria-hidden":"true"},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1),I=e("div",{class:"language-javascript ext-js line-numbers-mode"},[e("pre",{class:"language-javascript"},[e("code",null,[e("span",{class:"token keyword"},"const"),t(),e("span",{class:"token punctuation"},"{"),t(" autoRetry "),e("span",{class:"token punctuation"},"}"),t(),e("span",{class:"token operator"},"="),t(),e("span",{class:"token function"},"require"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},'"@grammyjs/auto-retry"'),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),t(`

`),e("span",{class:"token comment"},"// Use the plugin."),t(`
bot`),e("span",{class:"token punctuation"},"."),t("api"),e("span",{class:"token punctuation"},"."),t("config"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"use"),e("span",{class:"token punctuation"},"("),e("span",{class:"token function"},"autoRetry"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),t(`
`)])]),e("div",{class:"line-numbers","aria-hidden":"true"},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1),R=e("div",{class:"language-typescript ext-ts line-numbers-mode"},[e("pre",{class:"language-typescript"},[e("code",null,[e("span",{class:"token keyword"},"import"),t(),e("span",{class:"token punctuation"},"{"),t(" autoRetry "),e("span",{class:"token punctuation"},"}"),t(),e("span",{class:"token keyword"},"from"),t(),e("span",{class:"token string"},'"https://esm.sh/@grammyjs/auto-retry"'),e("span",{class:"token punctuation"},";"),t(`

`),e("span",{class:"token comment"},"// Use the plugin."),t(`
bot`),e("span",{class:"token punctuation"},"."),t("api"),e("span",{class:"token punctuation"},"."),t("config"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"use"),e("span",{class:"token punctuation"},"("),e("span",{class:"token function"},"autoRetry"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),t(`
`)])]),e("div",{class:"line-numbers","aria-hidden":"true"},[e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"}),e("div",{class:"line-number"})])],-1),T=o("<p>If you now call e.g. <code>send<wbr>Message</code> and run into a rate limit, it will look like the request just takes unusually long. Under the hood, multiple HTTP requests are being performed, with the appropriate delays in between.</p><p>You may pass an options object that specifies a maximum number of retries (<code>max<wbr>Retry<wbr>Attempts</code>, default: 3), or a threshold for a maximum time to wait (<code>max<wbr>Delay<wbr>Seconds</code>, default: 1 hour).</p>",2),A=t("As soon as the maximum number of retries is exhausted, subsequent errors for the same request will not be retried again. Instead, the error object from Telegram is passed on, effectively failing the request with a "),E=e("code",null,[t("Grammy"),e("wbr"),t("Error")],-1),P=t("."),S=o(`<p>Similarly, if the request ever fails with <code>retry<wbr>_after</code> larger than what is specified by the option <code>max<wbr>Delay<wbr>Seconds</code>, the request will fail immediately.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token function">autoRetry</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  maxRetryAttempts<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// only repeat requests once</span>
  maxDelaySeconds<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// fail immediately if we have to wait &gt;5 seconds</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can use <code>retry<wbr>OnInternal<wbr>Server<wbr>Errors</code> to include all other internal server errors by Telegram (status code &gt;= 500) in the above procedure. Those errors will be retried immediately, but they also respect the <code>max<wbr>Retry<wbr>Attempts</code> option.</p><h2 id="plugin-summary" tabindex="-1"><a class="header-anchor" href="#plugin-summary" aria-hidden="true">#</a> Plugin Summary</h2>`,4),C=e("li",null,[t("Name: "),e("code",null,[t("auto"),e("wbr"),t("-retry")])],-1),D=t("Source: "),N={href:"https://github.com/grammyjs/auto-retry",target:"_blank",rel:"noopener noreferrer"},Y=t("https://"),G=e("wbr",null,null,-1),z=t("github"),L=e("wbr",null,null,-1),B=t(".com"),H=e("wbr",null,null,-1),U=t("/grammyjs"),K=e("wbr",null,null,-1),O=t("/auto"),V=e("wbr",null,null,-1),F=t("-retry"),M=t("Reference: "),J={href:"https://doc.deno.land/https://raw.githubusercontent.com/grammyjs/auto-retry/main/src/index.ts",target:"_blank",rel:"noopener noreferrer"},W=o("https://<wbr>doc<wbr>.deno<wbr>.land<wbr>/https://<wbr>raw<wbr>.githubusercontent<wbr>.com<wbr>/grammyjs<wbr>/auto<wbr>-retry<wbr>/main<wbr>/src<wbr>/index<wbr>.ts",29);function Q(X,Z){const c=a("AutotagPage"),i=a("RouterLink"),r=a("CodeGroupItem"),u=a("CodeGroup"),l=a("ExternalLinkIcon");return d(),m("div",null,[b,n(c,{config:'[{"url":["/plugins"],"exclude":["console-time","middlewares","autoquote","guide","session","keyboard","/"],"tag":[{"template":"official","text":"OFFICIAL","desc":"This plugin is published and maintained by grammY","locale":{"es":{"text":"OFICIAL","desc":"Este plugin es publicado y mantenido por grammY"},"id":{"text":"RESMI","desc":"Plugin ini dipublikasi dan dikelola oleh grammY"},"zh":{"text":"\u5B98\u65B9\u7EF4\u62A4","desc":"\u8FD9\u4E2A\u63D2\u4EF6\u662F\u7531grammY\u53D1\u5E03\u548C\u7EF4\u62A4\u7684"}}}]},{"url":["/plugins"],"include":["console-time","middlewares","autoquote"],"tag":[{"template":"thirdparty","text":"THIRD-PARTY","desc":"This plugin is maintained by third-party","locale":{"es":{"text":"DE TERCEROS","desc":"Este plugin es mantenido por terceros"},"id":{"text":"PIHAK KETIGA","desc":"Plugin ini dikelola oleh pihak ketiga"},"zh":{"text":"\u7B2C\u4E09\u65B9","desc":"\u8FD9\u4E2A\u63D2\u4EF6\u662F\u7531\u7B2C\u4E09\u65B9\u7EF4\u62A4\u7684"}}}]},{"url":["/hosting"],"exclude":["gcf","comparison"],"tag":[{"template":"deno","desc":"This setup is able to run Deno bots","locale":{"es":{"desc":"Esta configuraci\xF3n es capaz de ejecutar bots Deno"},"id":{"desc":"Konfigurasi ini dapat dijalankan di bot Deno"},"zh":{"desc":"\u8FD9\u4E2A\u8BBE\u7F6E\u80FD\u591F\u8FD0\u884CDeno\u673A\u5668\u4EBA"}}}]},{"url":["/hosting"],"include":["heroku","vps"],"tag":[{"template":"nodejs","desc":"This setup is able to run Node.js bots","locale":{"es":{"desc":"Esta configuraci\xF3n es capaz de ejecutar bots Node.js"},"id":{"desc":"Konfigurasi ini dapat dijalankan di bot Node.js"},"zh":{"desc":"\u8FD9\u4E2A\u8BBE\u7F6E\u80FD\u591F\u8FD0\u884CNode.js\u673A\u5668\u4EBA"}}}]}]'}),e("blockquote",null,[e("p",null,[g,n(i,{to:"/plugins/transformer-throttler.html"},{default:s(()=>[_]),_:1}),k])]),e("p",null,[y,n(i,{to:"/advanced/transformers.html"},{default:s(()=>[f]),_:1}),w,v,x]),j,n(u,null,{default:s(()=>[n(r,{title:"TypeScript",active:""},{default:s(()=>[q]),_:1}),n(r,{title:"JavaScript"},{default:s(()=>[I]),_:1}),n(r,{title:"Deno"},{default:s(()=>[R]),_:1})]),_:1}),T,e("p",null,[A,n(i,{to:"/guide/errors.html#the-grammyerror-object"},{default:s(()=>[E]),_:1}),P]),S,e("ul",null,[C,e("li",null,[D,e("a",N,[Y,G,z,L,B,H,U,K,O,V,F,n(l)])]),e("li",null,[M,e("a",J,[W,n(l)])])])])}const ee=p(h,[["render",Q],["__file","auto-retry.html.vue"]]);export{ee as default};
