import{_ as p,r as c,o as r,c as d,b as a,a as n,w as e,d as s,e as k}from"./app.9a621f1c.js";const m={},b=n("h1",{id:"escalando-iii-fiabilidad",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#escalando-iii-fiabilidad","aria-hidden":"true"},"#"),s(" Escalando III: Fiabilidad")],-1),g=s("Si te aseguraste de tener un adecuado "),_=s("manejo de errores"),h=s(" para tu bot, b\xE1sicamente est\xE1s listo para ir. Todos los errores que se espera que ocurran (llamadas a la API que fallan, solicitudes de red que fallan, consultas a la base de datos que fallan, middleware que falla, etc) son capturados."),v=n("p",null,[s("Deber\xEDas asegurarte de siempre "),n("code",null,"esperar"),s(" todas las promesas, o al menos llamar a "),n("code",null,"catch"),s(" en ellas si alguna vez no quieres "),n("code",null,"esperar"),s(" cosas. Usa una regla de linting para asegurarte de que no puedes olvidar esto.")],-1),f=n("h2",{id:"apagado-correcto",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#apagado-correcto","aria-hidden":"true"},"#"),s(" Apagado correcto")],-1),y=s("Para los bots que utilizan long polling, hay una cosa m\xE1s a considerar. Como vas a detener tu instancia durante la operaci\xF3n en alg\xFAn momento de nuevo, deber\xEDas considerar la captura de eventos "),w=n("code",null,"SIGTERM",-1),q=s(" y "),x=n("code",null,"SIGINT",-1),I=s(", y llamar a "),z=n("code",null,[s("bot"),n("wbr"),s(".stop")],-1),S=s(" (long polling incorporado) o detener tu bot a trav\xE9s de su "),j={href:"https://doc.deno.land/https://deno.land/x/grammy_runner/mod.ts/~/RunnerHandle#stop",target:"_blank",rel:"noopener noreferrer"},E=s("manejador"),T=s(" (grammY runner):"),R=n("h3",{id:"simple-long-polling",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#simple-long-polling","aria-hidden":"true"},"#"),s(" Simple long polling")],-1),D=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"grammy"'),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bot"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"<token>"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Detener el bot cuando el proceso de Node"),s(`
`),n("span",{class:"token comment"},"// est\xE1 a punto de terminar"),s(`
process`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"once"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGINT"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
process`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"once"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGTERM"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"await"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),G=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"grammy"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bot"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"<token>"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Detener el bot cuando el proceso de Node"),s(`
`),n("span",{class:"token comment"},"// est\xE1 a punto de terminar"),s(`
process`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"once"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGINT"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
process`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"once"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGTERM"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"await"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),N=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"https://deno.land/x/grammy@v1.11.1/mod.ts"'),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bot"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"<token>"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Detener el bot cuando el proceso de Deno"),s(`
`),n("span",{class:"token comment"},"// est\xE1 a punto de terminar"),s(`
Deno`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addSignalListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGINT"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
Deno`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addSignalListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGTERM"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"await"),s(" bot"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),B=n("h3",{id:"usando-grammy-runner",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#usando-grammy-runner","aria-hidden":"true"},"#"),s(" Usando grammY runner")],-1),P=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"grammy"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" run "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"@grammyjs/runner"'),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bot"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"<token>"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" runner "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),s("bot"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Detener el bot cuando el proceso de Node"),s(`
`),n("span",{class:"token comment"},"// est\xE1 a punto de terminar"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"stopRunner"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" runner"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isRunning"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(" runner"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
process`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"once"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGINT"'),n("span",{class:"token punctuation"},","),s(" stopRunner"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
process`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"once"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGTERM"'),n("span",{class:"token punctuation"},","),s(" stopRunner"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),C=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"grammy"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" run "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"@grammyjs/runner"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bot"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"<token>"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" runner "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),s("bot"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Detener el bot cuando el proceso de Node"),s(`
`),n("span",{class:"token comment"},"// est\xE1 a punto de terminar"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"stopRunner"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" runner"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isRunning"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(" runner"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
process`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"once"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGINT"'),n("span",{class:"token punctuation"},","),s(" stopRunner"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
process`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"once"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGTERM"'),n("span",{class:"token punctuation"},","),s(" stopRunner"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Y=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"https://deno.land/x/grammy@v1.11.1/mod.ts"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" run "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"https://deno.land/x/grammy_runner@v1.0.4/mod.ts"'),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bot"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"<token>"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" runner "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),s("bot"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Detener el bot cuando el proceso de Deno"),s(`
`),n("span",{class:"token comment"},"// est\xE1 a punto de terminar"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"stopRunner"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" runner"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isRunning"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(" runner"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stop"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
Deno`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addSignalListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGINT"'),n("span",{class:"token punctuation"},","),s(" stopRunner"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
Deno`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addSignalListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SIGTERM"'),n("span",{class:"token punctuation"},","),s(" stopRunner"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),L=n("p",null,"Eso es b\xE1sicamente todo lo que hay que hacer para la fiabilidad, su instancia deber\xEDa:registrado: nunca\u2122\uFE0F fallar ahora.",-1),A=n("h2",{id:"garantias-de-fiabilidad",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#garantias-de-fiabilidad","aria-hidden":"true"},"#"),s(" Garant\xEDas de fiabilidad")],-1),M=s("\xBFQu\xE9 pasa si tu bot est\xE1 procesando transacciones financieras y debes considerar un "),U={href:"https://stackoverflow.com/questions/43724467/what-is-the-difference-between-kill-and-kill-9",target:"_blank",rel:"noopener noreferrer"},K=s("escenario de "),F=n("code",null,[s("kill "),n("wbr"),s("-9")],-1),H=s(" donde la CPU se rompe f\xEDsicamente o hay un corte de energ\xEDa en el centro de datos? Si por alguna raz\xF3n alguien o algo realmente mata el proceso, la cosa se complica un poco m\xE1s."),O=s("En esencia, los bots no pueden garantizar una ejecuci\xF3n "),V=n("em",null,"exacta",-1),J=s(" de su middleware. Lee "),Q={href:"https://github.com/tdlib/telegram-bot-api/issues/126",target:"_blank",rel:"noopener noreferrer"},W=s("esta discusi\xF3n en Git"),X=n("wbr",null,null,-1),Z=s("Hub"),$=s(" para aprender m\xE1s sobre "),nn=n("strong",null,"por qu\xE9",-1),sn=s(" tu bot podr\xEDa enviar mensajes duplicados (o ninguno) en casos extremadamente raros. El resto de esta secci\xF3n se refiere a "),an=n("strong",null,"c\xF3mo",-1),en=s(" se comporta grammY bajo estas circunstancias inusuales, y c\xF3mo manejar estas situaciones."),tn=k('<blockquote><p>\xBFS\xF3lo te interesa codificar un bot de Telegram? (/advanced/flood.md)</p></blockquote><h3 id="webhook" tabindex="-1"><a class="header-anchor" href="#webhook" aria-hidden="true">#</a> Webhook</h3><p>Si est\xE1s ejecutando tu bot con webhooks, el servidor de la API del bot reintentar\xE1 entregar actualizaciones a tu bot si no responde con <code>OK</code> a tiempo. Esto define el comportamiento del sistema de forma exhaustiva. Si necesitas evitar el procesamiento de actualizaciones duplicadas, deber\xE1s construir tu propia desduplicaci\xF3n basada en <code>update<wbr>_id</code>. grammY no hace esto por ti, pero si\xE9ntete libre de PR si crees que alguien m\xE1s podr\xEDa beneficiarse de esto.</p><h3 id="long-polling" tabindex="-1"><a class="header-anchor" href="#long-polling" aria-hidden="true">#</a> Long Polling</h3><p>El long polling es m\xE1s interesante. El long polling incorporado b\xE1sicamente vuelve a ejecutar el lote de actualizaci\xF3n m\xE1s reciente que fue obtenido pero no pudo completarse.</p><blockquote><p>Ten en cuenta que si detienes adecuadamente tu bot con <code>bot<wbr>.stop</code>, el desplazamiento de la actualizaci\xF3n se sincronizar\xE1 con los servidores de Telegram llamando a <code>get<wbr>Updates</code> con el desplazamiento correcto pero sin procesar los datos de la actualizaci\xF3n.</p></blockquote><p>En otras palabras, nunca perder\xE1s ninguna actualizaci\xF3n, sin embargo, puede ocurrir que vuelvas a procesar hasta 100 actualizaciones que hayas visto antes. Como las llamadas a <code>send<wbr>Message</code> no son idempotentes, los usuarios pueden recibir mensajes duplicados de tu bot. Sin embargo, se garantiza el procesamiento de <em>al menos una vez</em>.</p><h3 id="grammy-runner" tabindex="-1"><a class="header-anchor" href="#grammy-runner" aria-hidden="true">#</a> grammY Runner</h3>',8),on=s("Si est\xE1s utilizando el "),cn=s("grammY runner"),ln=s(" en modo concurrente, la siguiente llamada a "),un=n("code",null,[s("get"),n("wbr"),s("Updates")],-1),pn=s(" se realiza potencialmente antes de que tu middleware procese la primera actualizaci\xF3n del lote actual. Por lo tanto, el desplazamiento de la actualizaci\xF3n es "),rn={href:"https://core.telegram.org/bots/api#getupdates",target:"_blank",rel:"noopener noreferrer"},dn=s("confirmado"),kn=s(" prematuramente. Este es el coste de una gran concurrencia, y desafortunadamente, no puede evitarse sin reducir tanto el rendimiento como la capacidad de respuesta. Como resultado, si tu instancia es eliminada en el momento correcto (equivocado), podr\xEDa ocurrir que hasta 100 actualizaciones no puedan ser obtenidas de nuevo porque Telegram las considera confirmadas. Esto lleva a la p\xE9rdida de datos."),mn=n("p",null,"Si es crucial prevenir esto, deber\xEDas usar las fuentes y sumideros del paquete grammY runner para componer tu propio pipeline de actualizaci\xF3n que pase todas las actualizaciones a trav\xE9s de una cola de mensajes primero.",-1),bn=s("B\xE1sicamente tendr\xEDas que crear un "),gn={href:"https://doc.deno.land/https://deno.land/x/grammy_runner/mod.ts/~/UpdateSink",target:"_blank",rel:"noopener noreferrer"},_n=s("sink"),hn=s(" que empuje a la cola, e iniciar un corredor que s\xF3lo alimente tu cola de mensajes."),vn=s("A continuaci\xF3n, tendr\xEDa que crear un "),fn={href:"https://doc.deno.land/https://deno.land/x/grammy_runner/mod.ts/~/UpdateSource",target:"_blank",rel:"noopener noreferrer"},yn=s("source"),wn=s(" que se alimente de la cola de mensajes de nuevo. Efectivamente, ejecutar\xE1 dos instancias diferentes del corredor grammY."),qn=s("Este vago borrador descrito arriba s\xF3lo ha sido esbozado pero no implementado, seg\xFAn nuestro conocimiento. Por favor, "),xn={href:"https://t.me/grammyjs",target:"_blank",rel:"noopener noreferrer"},In=s("ponte en contacto con el grupo de Telegram"),zn=s(" si tienes alguna pregunta o si intentas esto y puedes compartir tu progreso."),Sn=s("Por otro lado, si tu bot est\xE1 bajo una gran carga y el sondeo de actualizaciones se ralentiza debido a las "),jn=s("restricciones de carga autom\xE1tica"),En=s(", aumentan las posibilidades de que algunas actualizaciones sean recuperadas de nuevo, lo que lleva a la duplicaci\xF3n de mensajes de nuevo. Por lo tanto, el precio de la concurrencia total es que no se puede garantizar el procesamiento "),Tn=n("em",null,"al menos una vez",-1),Rn=s(" ni "),Dn=n("em",null,"como m\xE1ximo una vez",-1),Gn=s(".");function Nn(Bn,Pn){const u=c("AutotagPage"),l=c("RouterLink"),t=c("ExternalLinkIcon"),o=c("CodeGroupItem"),i=c("CodeGroup");return r(),d("div",null,[b,a(u,{config:'[{"url":["/plugins"],"exclude":["console-time","middlewares","autoquote","guide","session","keyboard","/"],"tag":[{"template":"official","text":"OFFICIAL","desc":"This plugin is published and maintained by grammY","locale":{"es":{"text":"OFICIAL","desc":"Este plugin es publicado y mantenido por grammY"},"id":{"text":"RESMI","desc":"Plugin ini dipublikasi dan dikelola oleh grammY"},"zh":{"text":"\u5B98\u65B9\u7EF4\u62A4","desc":"\u8FD9\u4E2A\u63D2\u4EF6\u662F\u7531grammY\u53D1\u5E03\u548C\u7EF4\u62A4\u7684"}}}]},{"url":["/plugins"],"include":["console-time","middlewares","autoquote"],"tag":[{"template":"thirdparty","text":"THIRD-PARTY","desc":"This plugin is maintained by third-party","locale":{"es":{"text":"DE TERCEROS","desc":"Este plugin es mantenido por terceros"},"id":{"text":"PIHAK KETIGA","desc":"Plugin ini dikelola oleh pihak ketiga"},"zh":{"text":"\u7B2C\u4E09\u65B9","desc":"\u8FD9\u4E2A\u63D2\u4EF6\u662F\u7531\u7B2C\u4E09\u65B9\u7EF4\u62A4\u7684"}}}]},{"url":["/hosting"],"exclude":["gcf","comparison"],"tag":[{"template":"deno","desc":"This setup is able to run Deno bots","locale":{"es":{"desc":"Esta configuraci\xF3n es capaz de ejecutar bots Deno"},"id":{"desc":"Konfigurasi ini dapat dijalankan di bot Deno"},"zh":{"desc":"\u8FD9\u4E2A\u8BBE\u7F6E\u80FD\u591F\u8FD0\u884CDeno\u673A\u5668\u4EBA"}}}]},{"url":["/hosting"],"include":["heroku","vps"],"tag":[{"template":"nodejs","desc":"This setup is able to run Node.js bots","locale":{"es":{"desc":"Esta configuraci\xF3n es capaz de ejecutar bots Node.js"},"id":{"desc":"Konfigurasi ini dapat dijalankan di bot Node.js"},"zh":{"desc":"\u8FD9\u4E2A\u8BBE\u7F6E\u80FD\u591F\u8FD0\u884CNode.js\u673A\u5668\u4EBA"}}}]}]'}),n("p",null,[g,a(l,{to:"/es/guide/errors.html"},{default:e(()=>[_]),_:1}),h]),v,f,n("p",null,[y,w,q,x,I,z,S,n("a",j,[E,a(t)]),T]),R,a(i,null,{default:e(()=>[a(o,{title:"TypeScript",active:""},{default:e(()=>[D]),_:1}),a(o,{title:"JavaScript"},{default:e(()=>[G]),_:1}),a(o,{title:"Deno"},{default:e(()=>[N]),_:1})]),_:1}),B,a(i,null,{default:e(()=>[a(o,{title:"TypeScript",active:""},{default:e(()=>[P]),_:1}),a(o,{title:"JavaScript"},{default:e(()=>[C]),_:1}),a(o,{title:"Deno"},{default:e(()=>[Y]),_:1})]),_:1}),L,A,n("p",null,[M,n("a",U,[K,F,a(t)]),H]),n("p",null,[O,V,J,n("a",Q,[W,X,Z,a(t)]),$,nn,sn,an,en]),tn,n("p",null,[on,a(l,{to:"/es/plugins/runner.html"},{default:e(()=>[cn]),_:1}),ln,un,pn,n("a",rn,[dn,a(t)]),kn]),mn,n("ol",null,[n("li",null,[n("p",null,[bn,n("a",gn,[_n,a(t)]),hn])]),n("li",null,[n("p",null,[vn,n("a",fn,[yn,a(t)]),wn])])]),n("p",null,[qn,n("a",xn,[In,a(t)]),zn]),n("p",null,[Sn,a(l,{to:"/es/plugins/runner.html#sink"},{default:e(()=>[jn]),_:1}),En,Tn,Rn,Dn,Gn])])}const Yn=p(m,[["render",Nn],["__file","reliability.html.vue"]]);export{Yn as default};
