import{_ as u,r as o,o as l,c as d,b as s,a,w as p,d as n,e}from"./app.9837a88d.js";const k={},r=a("h1",{id:"membangkitkan-middleware",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#membangkitkan-middleware","aria-hidden":"true"},"#"),n(" Membangkitkan Middleware")],-1),m=n("Di "),b=n("bab sebelumnya"),g=n(", kami telah menjelaskan middleware sebagai lapisan-lapisan function yang saling bertumpukan. Meski tidak sepenuhnya salah, namun menyebutnya sebagai \u201Ctumpukan\u201D atau "),h=a("em",null,"stack",-1),v=n(" hanyalah penyederhanaan supaya mudah dipahami."),y=e(`<h2 id="middleware-di-grammy" tabindex="-1"><a class="header-anchor" href="#middleware-di-grammy" aria-hidden="true">#</a> Middleware di grammY</h2><p>Umumnya, kamu akan menemui pola seperti ini.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;token&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),f=n("Memang mirip seperti tumpukan, tetapi di balik layar mereka sebenarnya lebih mirip seperti cabang pohon. Komponen utama pembentuk pohon ini adalah class "),_=a("code",null,"Composer",-1),w=n(" ("),C={href:"https://doc.deno.land/https://deno.land/x/grammy/mod.ts/~/Composer",target:"_blank",rel:"noopener noreferrer"},x=n("referensi"),j=n(")."),A=a("p",null,[n("Pertama-tama, setiap instance "),a("code",null,"Bot"),n(" adalah instance dari "),a("code",null,"Composer"),n(". Ia hanyalah sebuah subclass. Oleh karena itu "),a("code",null,"class Bot extends Composer"),n(".")],-1),B=e("Kamu juga harus tahu bahwa setiap method <code>Composer</code> di dalamnya memanggil <code>use</code>. Sebagai contoh, <code>filter</code> memanggil <code>use</code> dengan beberapa percabangan middleware, sementara <code>on</code> memanggil <code>filter</code> lagi dengan beberapa <em>predicate function</em> yang terdapat kecocokan antara update dan ",15),D=n("filter query"),q=n(" yang diberikan. Untuk saat ini, kita cukupkan pembahasan mengenai "),E=a("code",null,"use",-1),I=n(" dan lanjut ke pembahasan berikutnya."),K=e(`<p>Kita akan mengupas sedikit mengenai apa yang dilakukan <code>Composer</code> terhadap pemanggilan <code>use</code>, dan apa bedanya dengan sistem middleware lain di luar sana. Perbedaannya mungkin tidak begitu mencolok, tetapi tunggu hingga kita membahas mengenai manfaat luar biasa yang dihasilkannya.</p><h2 id="memperbanyak-composer" tabindex="-1"><a class="header-anchor" href="#memperbanyak-composer" aria-hidden="true">#</a> Memperbanyak <code>Composer</code></h2><p>Kamu bisa memasang lebih banyak middleware di instance <code>Composer</code>, bahkan setelah memasang <code>Composer</code> itu sendiri di tempat lain.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;token&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// subclass dari \`Composer\`</span>

<span class="token keyword">const</span> composer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Composer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>composer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Berikut akan dijalankan:</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* A */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* B */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* C */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>A</code>, <code>B</code>, dan <code>C</code> akan dijalankan. Yang dimaksud di sini adalah setelah kamu menambahkan sebuah instance <code>Composer</code>, kamu masih bisa memanggil <code>use</code> pada instance tersebut dan semua middleware-nya akan tetap dijalankan. (Ini bukan sesuatu yang istimewa, tetapi sudah menjadi sebuah pembeda utama dari framework populer sejenis yang mengabaikan pemanggilan berikutnya).</p><p>Kamu mungkin bertanya-tanya dimana struktur pohonnya. Mari kita lihat potongan kode berikut:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> composer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Composer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* A */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* B */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* C */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* D */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* E */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* F */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* G */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* H */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* I */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* J */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* K */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* L */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sudah terlihat?</p><p>Yup, semua middleware tersebut akan dijalankan secara berurutan dari <code>A</code> ke <code>L</code>.</p><p>Library lain akan menjalankan kode dengan cara <code>composer<wbr>.use(<wbr>/* A *<wbr>/)<wbr>.use(<wbr>/* B *<wbr>/)<wbr>.use(<wbr>/* C *<wbr>/)<wbr>.use(<wbr>/* D *<wbr>/)<wbr>..<wbr>.</code> dan seterusnya. Sebaliknya, grammY menggunakan struktur pohon: satu simpul akar (<code>composer</code>) memiliki lima cabang (<code>A</code>, <code>B</code>, <code>D</code>, <code>H</code>, <code>J</code>), sementara cabang dari <code>B</code> memiliki satu anak cabang, yaitu <code>C</code>, dan seterusnya. Pohon ini kemudian akan dilalui oleh setiap update sesuai urutan kedalamannya, yang sama efektifnya dengan melewati <code>A</code> ke <code>L</code> secara berurutan, mirip yang kita kenal di sistem lain.</p><p>Proses ini memungkinkan untuk membuat instance baru dari <code>Composer</code> setiap kali kamu memanggil <code>use</code>, yang kemudian akan di-extend (seperti yang sudah diterangkan di atas).</p><h2 id="menggabungkan-pemanggilan-use" tabindex="-1"><a class="header-anchor" href="#menggabungkan-pemanggilan-use" aria-hidden="true">#</a> Menggabungkan Pemanggilan <code>use</code></h2><p>Kalau kita hanya menggunakan satu <code>use</code>, itu tidak akan terlalu bag-<em>use</em> \u2014 <em>maaf, garing</em> \u{1F62C}. Akan semakin menarik ketika kita menambahkan sesuatu ke dalamnya, misal <code>filter</code>.</p><p>Lihat kode berikut:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> composer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Composer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

composer<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token comment">/* 1 */</span><span class="token punctuation">,</span> <span class="token comment">/* A */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* B */</span><span class="token punctuation">)</span>

composer<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token comment">/* 2 */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* C */</span><span class="token punctuation">,</span> <span class="token comment">/* D */</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Di baris 3, kita menambahkan <code>A</code> di belakang <em>predicate function</em> <code>1</code>. <code>A</code> akan dievaluasi untuk update hanya jika kondisi <code>1</code> terpenuhi. Meski begitu, <code>filter</code> mengembalikan instance <code>Composer</code> yang telah kita tambahkan dengan pemanggilan <code>use</code> di baris 3, sehingga <code>B</code> masih terproteksi oleh <code>1</code>, meskipun ia dipasang di pemanggilan <code>use</code> yang berbeda.</p><p>Baris 5 sama halnya dengan baris 3, <code>C</code> dan <code>D</code> hanya akan dijalankan jika kondisi <code>2</code> terpenuhi.</p><p>Masih ingat bagaimana pemanggilan <code>bot<wbr>.on()</code> bisa dirangkai untuk menggabungkan beberapa <em>filter query</em> menggunakan AND? Sekarang, bayangkan ini:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> composer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Composer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

composer<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token comment">/* 1 */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token comment">/* 2 */</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/* A */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>2</code> hanya akan dievaluasi jika <code>1</code> terpenuhi, dan <code>A</code> hanya akan dijalankan jika <code>2</code> (serta <code>1</code>) terpenuhi.</p>`,20),L=n("Coba kunjungi kembali materi mengenai "),M=n("pengombinasian filter query"),P=n(" dengan pengetahuan dan kekuatan barumu."),N=e("<p>Khusus <code>fork</code> sedikit berbeda karena ia memulai dua komputasi secara bersamaan, misal disisipkan ke <em>event loop</em>. Alih-alih mengembalikan instance <code>Composer</code> yang dibuat oleh pemanggilan <code>use</code>, ia mengembalikan sebuah <code>Composer</code> yang merefleksikan komputasi percabangan. Dengan begitu akan memungkinkan untuk membuat pola seperti <code>bot<wbr>.fork()<wbr>.on(&quot;:<wbr>text&quot;)<wbr>.use(<wbr>/* A *<wbr>/)</code>. <code>A</code> sekarang akan dieksekusi di percabangan komputasi paralel.</p>",1);function T(Y,R){const c=o("AutotagPage"),t=o("RouterLink"),i=o("ExternalLinkIcon");return l(),d("div",null,[r,s(c,{config:'[{"url":["/plugins"],"exclude":["console-time","middlewares","autoquote","guide","session","keyboard","/"],"tag":[{"template":"official","text":"OFFICIAL","desc":"This plugin is published and maintained by grammY","locale":{"es":{"text":"OFICIAL","desc":"Este plugin es publicado y mantenido por grammY"},"id":{"text":"RESMI","desc":"Plugin ini dipublikasi dan dikelola oleh grammY"},"zh":{"text":"\u5B98\u65B9\u7EF4\u62A4","desc":"\u8FD9\u4E2A\u63D2\u4EF6\u662F\u7531grammY\u53D1\u5E03\u548C\u7EF4\u62A4\u7684"}}}]},{"url":["/plugins"],"include":["console-time","middlewares","autoquote"],"tag":[{"template":"thirdparty","text":"THIRD-PARTY","desc":"This plugin is maintained by third-party","locale":{"es":{"text":"DE TERCEROS","desc":"Este plugin es mantenido por terceros"},"id":{"text":"PIHAK KETIGA","desc":"Plugin ini dikelola oleh pihak ketiga"},"zh":{"text":"\u7B2C\u4E09\u65B9","desc":"\u8FD9\u4E2A\u63D2\u4EF6\u662F\u7531\u7B2C\u4E09\u65B9\u7EF4\u62A4\u7684"}}}]},{"url":["/hosting"],"exclude":["gcf","comparison"],"tag":[{"template":"deno","desc":"This setup is able to run Deno bots","locale":{"es":{"desc":"Esta configuraci\xF3n es capaz de ejecutar bots Deno"},"id":{"desc":"Konfigurasi ini dapat dijalankan di bot Deno"},"zh":{"desc":"\u8FD9\u4E2A\u8BBE\u7F6E\u80FD\u591F\u8FD0\u884CDeno\u673A\u5668\u4EBA"}}}]},{"url":["/hosting"],"include":["heroku","vps"],"tag":[{"template":"nodejs","desc":"This setup is able to run Node.js bots","locale":{"es":{"desc":"Esta configuraci\xF3n es capaz de ejecutar bots Node.js"},"id":{"desc":"Konfigurasi ini dapat dijalankan di bot Node.js"},"zh":{"desc":"\u8FD9\u4E2A\u8BBE\u7F6E\u80FD\u591F\u8FD0\u884CNode.js\u673A\u5668\u4EBA"}}}]}]'}),a("p",null,[m,s(t,{to:"/id/guide/middleware.html"},{default:p(()=>[b]),_:1}),g,h,v]),y,a("p",null,[f,_,w,a("a",C,[x,s(i)]),j]),A,a("p",null,[B,s(t,{to:"/id/guide/filter-queries.html"},{default:p(()=>[D]),_:1}),q,E,I]),K,a("p",null,[L,s(t,{to:"/id/guide/filter-queries.html#mengombinasikan-beberapa-query"},{default:p(()=>[M]),_:1}),P]),N])}const z=u(k,[["render",T],["__file","middleware.html.vue"]]);export{z as default};
