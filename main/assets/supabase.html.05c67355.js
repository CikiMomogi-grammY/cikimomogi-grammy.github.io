import{_ as u,r as o,o as i,c as l,a as s,b as a,w as p,d as n,e as c}from"./app.cd079934.js";const r={},d=s("h1",{id:"hosting-supabase-edge-functions",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#hosting-supabase-edge-functions","aria-hidden":"true"},"#"),n(" Hosting: Supabase Edge Functions")],-1),k=n("Esta gu\xEDa te explica c\xF3mo puedes alojar tus bots de grammY en "),b={href:"https://supabase.com/",target:"_blank",rel:"noopener noreferrer"},m=n("Supabase"),h=n("."),g=n("Ten en cuenta que necesitas tener una cuenta de "),_={href:"https://github.com",target:"_blank",rel:"noopener noreferrer"},v=n("Git"),f=s("wbr",null,null,-1),y=n("Hub"),q=n(" antes de poder utilizar "),w={href:"https://supabase.com/docs/guides/functions",target:"_blank",rel:"noopener noreferrer"},x=n("Supabase Edge Functions"),T=n(". Adem\xE1s, Supabase Edge Functions se basa en "),E={href:"https://deno.com/deploy",target:"_blank",rel:"noopener noreferrer"},S=n("Deno Deploy"),B=n(", as\xED que al igual que "),j=n("nuestra gu\xEDa de Deno Deploy"),O=n(", esta gu\xEDa es s\xF3lo para usuarios de Deno de grammY."),D=s("p",null,"Supabase Edge Functions es ideal para la mayor\xEDa de los bots simples, y debes tener en cuenta que no todas las caracter\xEDsticas de Deno est\xE1n disponibles para las aplicaciones que se ejecutan en Supabase Edge Functions. Por ejemplo, no hay sistema de archivos en Supabase Edge Functions. Es igual que las otras plataformas sin servidor, pero dedicado a las aplicaciones de Deno.",-1),N=n("El resultado de este tutorial "),P={href:"https://github.com/grammyjs/examples/tree/main/supabase-edge-functions",target:"_blank",rel:"noopener noreferrer"},C=n("se puede ver en nuestro repositorio de bots de ejemplo"),F=n("."),R=s("h2",{id:"configuracion",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#configuracion","aria-hidden":"true"},"#"),n(" Configuraci\xF3n")],-1),z=n("Para desplegar una funci\xF3n de borde de Supabase, necesitar\xE1s crear una cuenta de Supabase, instalar su CLI, y crear un proyecto de Supabase. Primero debes "),A={href:"https://supabase.com/docs/guides/functions#prerequisites",target:"_blank",rel:"noopener noreferrer"},L=n("seguir su documentaci\xF3n"),K=n(" para configurar las cosas."),U=c(`<p>Crea una nueva Funci\xF3n Supabase ejecutando este comando:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>supabase functions new telegram-bot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Una vez que hayas creado un proyecto de Supabase Function, puedes escribir tu bot.</p><h2 id="preparando-tu-codigo" tabindex="-1"><a class="header-anchor" href="#preparando-tu-codigo" aria-hidden="true">#</a> Preparando tu c\xF3digo</h2>`,4),V=n("Recuerda que necesitas "),W=n("ejecutar tu bot en webhhoks"),I=n(", por lo que debes usar "),J=s("code",null,[n("webhook"),s("wbr"),n("Callback")],-1),Y=n(" y no llamar a "),H=s("code",null,[n("bot"),s("wbr"),n(".start()")],-1),M=n(" en tu c\xF3digo."),G=c(`<p>Puedes utilizar este breve ejemplo de bot como punto de partida.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> serve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://deno.land/std@0.158.0/http/server.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bot<span class="token punctuation">,</span> webhookCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://deno.land/x/grammy@v1.11.1/mod.ts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot</span><span class="token punctuation">(</span>Deno<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;BOT_TOKEN&quot;</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;\xA1Bienvenido! En marcha&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;ping&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\xA1Pong! </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> handleUpdate <span class="token operator">=</span> <span class="token function">webhookCallback</span><span class="token punctuation">(</span>bot<span class="token punctuation">,</span> <span class="token string">&quot;std/http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">serve</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> bot<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">&quot;not allowed&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">405</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">handleUpdate</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="despliegue" tabindex="-1"><a class="header-anchor" href="#despliegue" aria-hidden="true">#</a> Despliegue</h2><p>Ahora puedes desplegar tu bot en Supabase. Ten en cuenta que tendr\xE1s que deshabilitar la autorizaci\xF3n JWT porque Telegram utiliza una forma diferente de asegurarse de que las peticiones provienen de Telegram. Puedes desplegar la funci\xF3n usando este comando.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>supabase functions deploy --no-verify-jwt telegram-bot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>A continuaci\xF3n, tienes que dar tu token de bot a Supabase para que tu c\xF3digo tenga acceso a \xE9l como variable de entorno.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Reemplaza 123:aBcDeF-gh con tu token de bot real.</span>
supabase secrets <span class="token builtin class-name">set</span> <span class="token assign-left variable">BOT_TOKEN</span><span class="token operator">=</span><span class="token number">123</span>:aBcDeF-gh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Tu funci\xF3n Supabase ya est\xE1 funcionando. Todo lo que queda por hacer es decirle a Telegram d\xF3nde enviar las actualizaciones. Puedes hacerlo llamando a <code>set<wbr>Webhook</code>. Por ejemplo, abre una nueva pesta\xF1a en tu navegador y visita esta URL:</p><div class="language-plaintext ext-plaintext line-numbers-mode"><pre class="language-plaintext"><code>https://api.telegram.org/bot&lt;BOT_TOKEN&gt;/setWebhook?url=https://&lt;PROJECT_NAME&gt;.functions.supabase.co/telegram-bot?secret=&lt;BOT_TOKEN&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Sustituye <code>&lt;BOT<wbr>_TOKEN&gt;</code> por tu token de bot real. Adem\xE1s, sustituye la segunda aparici\xF3n de <code>&lt;BOT<wbr>_TOKEN&gt;</code> por tu token de bot real. Sustituye <code>&lt;PROJECT<wbr>_NAME&gt;</code> por el nombre de tu proyecto Supabase.</p><p>Ahora deber\xEDas ver esto en la ventana de tu navegador.</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;ok&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Webhook was set&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Ya est\xE1. Tu bot ya est\xE1 funcionando. Dir\xEDgete a Telegram y observa c\xF3mo responde a los mensajes.</p>`,13);function $(Q,X){const e=o("ExternalLinkIcon"),t=o("RouterLink");return i(),l("div",null,[d,s("p",null,[k,s("a",b,[m,a(e)]),h]),s("p",null,[g,s("a",_,[v,f,y,a(e)]),q,s("a",w,[x,a(e)]),T,s("a",E,[S,a(e)]),B,a(t,{to:"/es/hosting/deno-deploy.html"},{default:p(()=>[j]),_:1}),O]),D,s("p",null,[N,s("a",P,[C,a(e)]),F]),R,s("p",null,[z,s("a",A,[L,a(e)]),K]),U,s("blockquote",null,[s("p",null,[V,a(t,{to:"/es/guide/deployment-types.html#c%C3%B3mo-usar-webhooks"},{default:p(()=>[W]),_:1}),I,J,Y,H,M])]),G])}const nn=u(r,[["render",$],["__file","supabase.html.vue"]]);export{nn as default};
